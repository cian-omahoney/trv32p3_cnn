
# File generated by Go version U-2022.12#33f3808fcb#221128, Thu Jan 25 16:08:15 2024
# Copyright 2014-2022 Synopsys, Inc. All rights reserved.
# go -I../lib -F -DSYNTHESIS_NO_UNGROUP -D__tct_patch__=0 -Verilog -otrv32p3_cnn_vlog -cgo_options.cfg -Itrv32p3_cnn_vlog/tmp_pdg -updg -updg_controller trv32p3_cnn




# THISDIR specifies path to the directory of this Makefile
THISDIR = $(shell dirname $(realpath $(lastword $(MAKEFILE_LIST))))
MAKEDIR = $(THISDIR)

LIBDIR    = $(THISDIR)/trv32p3_cnn/go_bin
LIBDIR_TB = $(THISDIR)/test_bench/go_tb_bin

SOURCES_RTL =  \
	trv32p3_cnn/controller/controller.v \
	trv32p3_cnn/controller/hazards.v \
	trv32p3_cnn/controller/debug_controller.v \
	trv32p3_cnn/controller/decoder.v \
	trv32p3_cnn/mux/mux_pm_addr.v \
	trv32p3_cnn/mux/mux_pm_wr.v \
	trv32p3_cnn/mux/mux_dm_addr.v \
	trv32p3_cnn/mux/mux_dmb_wr.v \
	trv32p3_cnn/mux/mux_x_w1.v \
	trv32p3_cnn/mux/mux_x_w1_dead.v \
	trv32p3_cnn/mux/mux_ocd_data_w.v \
	trv32p3_cnn/mux/mux_ocd_instr_w.v \
	trv32p3_cnn/mux/mux_aluA.v \
	trv32p3_cnn/mux/mux_aluB.v \
	trv32p3_cnn/mux/mux_pcaA.v \
	trv32p3_cnn/mux/mux_pcaB.v \
	trv32p3_cnn/mux/mux_jmp_tgt_ID.v \
	trv32p3_cnn/mux/mux_aguB.v \
	trv32p3_cnn/mux/mux_mpyM.v \
	trv32p3_cnn/mux/mux_ocd_swbreak.v \
	trv32p3_cnn/mux/mux___pidTGT_w.v \
	trv32p3_cnn/mux/mux___X_x_w1_wad.v \
	trv32p3_cnn/pipe/pipe___pidTGT.v \
	trv32p3_cnn/pipe/pipe___ocd_ld_DMbEX.v \
	trv32p3_cnn/pipe/pipe___ocd_ld_DMbS3.v \
	trv32p3_cnn/pipe/pipe___ocd_st_DMbEX.v \
	trv32p3_cnn/pipe/pipe___ocd_st_DMbS3.v \
	trv32p3_cnn/pipe/pipe___ocd_ld_PMbEX.v \
	trv32p3_cnn/pipe/pipe___ocd_ld_PMbS3.v \
	trv32p3_cnn/pipe/pipe___ocd_st_PMbEX.v \
	trv32p3_cnn/reg/reg_PC.v \
	trv32p3_cnn/reg/reg_PC_ID.v \
	trv32p3_cnn/reg/reg_PC_EX.v \
	trv32p3_cnn/reg/reg_X.v \
	trv32p3_cnn/reg/reg_ocd_addr.v \
	trv32p3_cnn/reg/reg_ocd_data.v \
	trv32p3_cnn/reg/reg_ocd_instr.v \
	trv32p3_cnn/mem/dm_merge.v \
	trv32p3_cnn/mem/dm_wbb.v \
	trv32p3_cnn/mem/mem_PMb.v \
	trv32p3_cnn/mem/mem_DMb.v \
	trv32p3_cnn/prim/alu.v \
	trv32p3_cnn/prim/pca.v \
	trv32p3_cnn/prim/cmp.v \
	trv32p3_cnn/prim/div.v \
	trv32p3_cnn/prim/lx.v \
	trv32p3_cnn/prim/agu.v \
	trv32p3_cnn/prim/mpy.v \
	trv32p3_cnn/prim/ocd_addr_incr.v \
	trv32p3_cnn/prim/cnn.v \
	trv32p3_cnn/trv32p3_cnn.v
SOURCES_TB =  \
	test_bench/clock_gen.v \
	test_bench/jtag_tap_controller.v \
	test_bench/jtag_emulator.v \
	test_bench/jtag_scan_register.v \
	test_bench/jtag_interface.v \
	test_bench/tb_mem_PMb.v \
	test_bench/tb_mem_eDM.v \
	test_bench/test_bench.v

# Note: If 'which <tool>' does not point to the real installation,
# you may overwrite the makefile variables by specifying them as
# command line option, e.g. 'make <target> SIM_INSTALL=<real dir>'
# or 'make <target> CHESSDE_INSTALL=<real dir>
# or 'make <target> GCCLIB_PATH=<path to libstdc++>'
SIM_INSTALL = $(dir $(shell which vcs))
CHESSDE_INSTALL  = $(dir $(shell which chessde))
GO_INCLUDE  = $(CHESSDE_INSTALL)/../../chessdir/godir/include
CHESSDIR_INCLUDE  = $(CHESSDE_INSTALL)/../../chessdir
CHECKERS_INCLUDE  = $(CHESSDE_INSTALL)/../../chessdir/checkersdir/include
VPI_INCLUDE = $(SIM_INSTALL)/../include
JTAG_EMU = jtag_emulator_vpi.so
SO_CC = g++
SO_LD = g++
SO_CCFLAGS = -m32 -c -fPIC -std=c++11 -g -DVCS -DOLD_VCS_VHPI
SO_LDFLAGS = -m32 -shared -fPIC
GCCLIB_PATH = $(dir $(realpath $(shell which g++)))/../lib
ifdef LD_LIBRARY_PATH
    export LD_LIBRARY_PATH := $(GCCLIB_PATH):$(LD_LIBRARY_PATH)
else
    export LD_LIBRARY_PATH := $(GCCLIB_PATH)
endif
export ASIP_SPY_GOAL=lint/lint_rtl
export ASIP_SPY_PRJ=spyglass

default: all

all: appname elab
	$(THISDIR)/simv +warn=noSTASKW_CO -cm_name $(shell mktemp -u test.XXXXXXXXXXXXXXX)$(CM_SUFFIX) -cm line+cond+branch -cm_log $(patsubst %.log,%,cm$(CM_SUFFIX).log) -gui

appname:
ifdef APP
ifdef APPDIR
	@echo $(APPDIR)/$(APP) > appname.cfg
else
	@echo $(APP) > appname.cfg
endif
else
ifdef APPDIR
	@echo $(APPDIR)/data > appname.cfg
else
	@echo ./data > appname.cfg
endif
endif

$(LIBDIR):
	@mkdir -p $@

$(LIBDIR_TB):
	@mkdir -p $@

$(THISDIR)/$(JTAG_EMU): $(GO_INCLUDE)/jtag_emulator_vpi.cpp
	cd $(THISDIR) && $(SO_CC) $(SO_CCFLAGS) -I $(VPI_INCLUDE) -I $(GO_INCLUDE) -I $(CHESSDIR_INCLUDE) -I $(CHECKERS_INCLUDE) $(GO_INCLUDE)/jtag_emulator_vpi.cpp; \
	cd $(THISDIR) && $(SO_CC) $(SO_CCFLAGS) -I $(VPI_INCLUDE) -I $(CHESSDIR_INCLUDE) -I $(CHECKERS_INCLUDE) $(CHECKERS_INCLUDE)/jtag_socket.cpp; \
	cd $(THISDIR) && $(SO_LD) $(SO_LDFLAGS) -o $(JTAG_EMU) jtag_emulator_vpi.o jtag_socket.o -Wl,-rpath $(GCCLIB_PATH);

$(THISDIR)/.analyze.ok : $(LIBDIR) $(LIBDIR_TB) $(SOURCES_RTL:%=$(THISDIR)/%) $(SOURCES_TB:%=$(THISDIR)/%)
	cd $(THISDIR) && vlogan  -nc -kdb -work trv32p3_cnn_lib +v2k -sverilog -assert svaext +incdir+trv32p3_cnn/prim  $(SOURCES_RTL) && touch .analyze.ok
	cd $(THISDIR) && vlogan  -nc -kdb -work trv32p3_cnn_tb_lib +v2k -sverilog -assert svaext +incdir+trv32p3_cnn/prim  $(SOURCES_TB) && touch .analyze.ok || rm -f .analyze.ok

analyze: $(THISDIR)/.analyze.ok

$(THISDIR)/.elab.ok : $(THISDIR)/.analyze.ok $(THISDIR)/$(JTAG_EMU)
	cd $(THISDIR) && vcs -kdb -debug_access+pp+f -xprop  -o simv trv32p3_cnn_tb_lib.test_bench -load $(THISDIR)/$(JTAG_EMU):jtag_vpi_register_tfs -cm line+cond+branch -cm_cond basic+allops && touch .elab.ok

elab: $(THISDIR)/.elab.ok

dve: appname elab
	$(THISDIR)/simv +warn=noSTASKW_CO -cm_name $(shell mktemp -u test.XXXXXXXXXXXXXXX)$(CM_SUFFIX) -cm line+cond+branch -cm_log $(patsubst %.log,%,cm$(CM_SUFFIX).log) -gui=dve

dve_dumpall: appname elab
	$(THISDIR)/simv +warn=noSTASKW_CO -cm_name $(shell mktemp -u test.XXXXXXXXXXXXXXX)$(CM_SUFFIX) -cm line+cond+branch -cm_log $(patsubst %.log,%,cm$(CM_SUFFIX).log) -do $(THISDIR)/gen_dump.tcl -gui=dve

verdi: appname elab
	$(THISDIR)/simv +warn=noSTASKW_CO -cm_name $(shell mktemp -u test.XXXXXXXXXXXXXXX)$(CM_SUFFIX) -cm line+cond+branch -cm_log $(patsubst %.log,%,cm$(CM_SUFFIX).log) -gui=verdi

verdi_dumpall: appname elab
	$(THISDIR)/simv +warn=noSTASKW_CO -cm_name $(shell mktemp -u test.XXXXXXXXXXXXXXX)$(CM_SUFFIX) -cm line+cond+branch -cm_log $(patsubst %.log,%,cm$(CM_SUFFIX).log) -do $(THISDIR)/gen_dump.tcl -gui=verdi

sim: appname
	$(THISDIR)/simv +warn=noSTASKW_CO -cm_name $(shell mktemp -u test.XXXXXXXXXXXXXXX)$(CM_SUFFIX) -cm line+cond+branch -cm_log $(patsubst %.log,%,cm$(CM_SUFFIX).log) -ucli -do $(THISDIR)/gen_sim_exit.tcl -licqueue


CLI_SCRIPT?=
cli: appname elab
	$(THISDIR)/simv +warn=noSTASKW_CO -cm_name $(shell mktemp -u test.XXXXXXXXXXXXXXX)$(CM_SUFFIX) -cm line+cond+branch -cm_log $(patsubst %.log,%,cm$(CM_SUFFIX).log) -ucli $(CLI_SCRIPT)

run: appname
	$(THISDIR)/simv +warn=noSTASKW_CO -cm_name $(shell mktemp -u test.XXXXXXXXXXXXXXX)$(CM_SUFFIX) -cm line+cond+branch -cm_log $(patsubst %.log,%,cm$(CM_SUFFIX).log)

rcd: appname
	$(THISDIR)/simv +warn=noSTASKW_CO -cm_name $(shell mktemp -u test.XXXXXXXXXXXXXXX)$(CM_SUFFIX) -cm line+cond+branch -cm_log $(patsubst %.log,%,cm$(CM_SUFFIX).log) -ucli -do $(THISDIR)/gen_rcd.tcl -licqueue

ext_stop: appname
	$(THISDIR)/simv +warn=noSTASKW_CO -cm_name $(shell mktemp -u test.XXXXXXXXXXXXXXX)$(CM_SUFFIX) -cm line+cond+branch -cm_log $(patsubst %.log,%,cm$(CM_SUFFIX).log) -ucli -do $(THISDIR)/gen_ext_stop.tcl -licqueue

#------ spyglass targets --------
spyglass_run:
	spyglass -goal $(ASIP_SPY_GOAL) -project $(THISDIR)/$(ASIP_SPY_PRJ).prj -batch

spyglass_grep_results:
	@chmod u+x $(THISDIR)/spyglass_grep_results.sh
	@$(THISDIR)/spyglass_grep_results.sh $(THISDIR) $(ASIP_SPY_PRJ) $(ASIP_SPY_GOAL)
#----------------------------------

saif:
	$(THISDIR)/simv +warn=noSTASKW_CO -cm_name $(shell mktemp -u test.XXXXXXXXXXXXXXX)$(CM_SUFFIX) -cm line+cond+branch -cm_log $(patsubst %.log,%,cm$(CM_SUFFIX).log) -ucli -do $(THISDIR)/gen_saif.tcl -licqueue

clean:
	@cd $(THISDIR) && rm -rf appname.cfg
	@cd $(THISDIR) && rm -rf trv32p3_cnn/go_bin
	@cd $(THISDIR) && rm -rf test_bench/go_tb_bin
	@cd $(THISDIR) && rm -rf .analyze*.ok .elab*.ok
	@cd $(THISDIR) && rm -rf csrc simv*
	@cd $(THISDIR) && rm -rf DVEfiles inter.vpd*
	@cd $(THISDIR) && rm -rf .restartSimSession.tcl*
	@cd $(THISDIR) && rm -rf .synopsys_dve_rebuild.tcl
	@cd $(THISDIR) && rm -rf .vlogansetup.args
	@cd $(THISDIR) && rm -rf novas.* novas_dump.*
	@cd $(THISDIR) && rm -rf inter.fsdb
	@cd $(THISDIR) && rm -rf verdiLog
	@cd $(THISDIR) && rm -rf ucli.key
	@cd $(THISDIR) && rm -rf jtag_socket*.o
	@cd $(THISDIR) && rm -rf jtag_emulator*.o
	@cd $(THISDIR) && rm -rf jtag_emulator*.so
	@cd $(THISDIR) && rm -rf libjtag_emulator*.so

test:
	@echo This model has I/O-Interfaces, use "\'iss -b <application>\'" to generate the memory content files.
