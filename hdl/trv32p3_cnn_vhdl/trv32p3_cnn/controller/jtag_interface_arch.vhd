
-- File generated by Go version U-2022.12#33f3808fcb#221128, Wed Feb 21 13:01:39 2024
-- Copyright 2014-2022 Synopsys, Inc. All rights reserved.
-- go -I../lib -F -DIS_VHDL -DSYNTHESIS_NO_UNGROUP -D__tct_patch__=0 -VHDL -otrv32p3_cnn_vhdl -cgo_options.cfg -Itrv32p3_cnn_vhdl/tmp_pdg -updg -updg_controller trv32p3_cnn



architecture rtl of jtag_interface is

  component jtag_scan_register
    generic (
      scan_reg_width_gen : natural := 16);
    port (
      jtag_trst : in std_logic;
      jtag_capture_dr_in : in std_logic;
      jtag_par_in : in std_logic_vector(scan_reg_width_gen-1 downto 0);
      jtag_shift_dr_in : in std_logic;
      jtag_si_in : in std_logic;
      jtag_tck_in : in std_logic;
      jtag_update_dr_in : in std_logic;
      jtag_par_out : out std_logic_vector(scan_reg_width_gen-1 downto 0);
      jtag_so_out : out std_logic);
  end component;

  signal dbg_data_we_REG : std_logic;
  signal dbg_instr_exec_REG : std_logic;
  signal jtag_update_dr_REG : std_logic;
  signal jtag_update_ir_REG : std_logic;
  signal sync_dr_REG : std_logic_vector(2 downto 0);
  signal sync_ir_REG : std_logic_vector(2 downto 0);

begin

  dbg_instr_exec_out <= dbg_instr_exec_REG;
  dbg_data_we_out <= dbg_data_we_REG;

  -- delay over JTAG clock (decode new JTAG instruction AFTER update_ir cycle)
  jtag_update_ir_delay : process(jtag_tck_in, jtag_trst)
  begin
    if jtag_trst /= '1' then
      jtag_update_ir_REG <= '0';
    elsif jtag_tck_in'event and jtag_tck_in = '1' then
      jtag_update_ir_REG <= jtag_update_ir_in;
    end if;
  end process jtag_update_ir_delay;

  -- synchronisation to processor clock
  sync_update_ir_proc : process(clock, reset_ext)
  begin
    if reset_ext /= '0' then
      sync_ir_REG <= (others => '1');
      dbg_instr_exec_REG <= '0';
    elsif clock'event and clock = '1' then
      sync_ir_REG(0) <= jtag_update_ir_REG;
      sync_ir_REG(1) <= sync_ir_REG(0);
      sync_ir_REG(2) <= sync_ir_REG(1);
      dbg_instr_exec_REG <= sync_ir_REG(1) and not sync_ir_REG(2);
    end if;
  end process sync_update_ir_proc;

  -- scan register contains new value AFTER update_dr cycle
  update_dr_delay : process(jtag_tck_in, jtag_trst)
  begin
    if jtag_trst /= '1' then
      jtag_update_dr_REG <= '0';
    elsif jtag_tck_in'event and jtag_tck_in = '1' then
      jtag_update_dr_REG <= jtag_update_dr_in;
    end if;
  end process update_dr_delay;

  -- synchronisation to processor clock
  sync_update_dr_proc : process(clock, reset_ext)
  begin
    if reset_ext /= '0' then
      sync_dr_REG <= (others => '1');
      dbg_data_we_REG <= '0';
    elsif clock'event and clock = '1' then
      sync_dr_REG(0) <= jtag_update_dr_REG;
      sync_dr_REG(1) <= sync_dr_REG(0);
      sync_dr_REG(2) <= sync_dr_REG(1);
      dbg_data_we_REG <= sync_dr_REG(1) and not sync_dr_REG(2);
    end if;
  end process sync_update_dr_proc;

  inst_dbg_scan_reg : jtag_scan_register
  generic map (
    scan_reg_width_gen => 32)
  port map (
    jtag_trst => jtag_trst,
    jtag_capture_dr_in => jtag_capture_dr_in,
    jtag_par_in => dbg_data_po_in,
    jtag_shift_dr_in => jtag_shift_dr_in,
    jtag_si_in => jtag_si_in,
    jtag_tck_in => jtag_tck_in,
    jtag_update_dr_in => jtag_update_dr_in,
    jtag_par_out => dbg_data_pi_out,
    jtag_so_out => jtag_so_out);

end rtl;
